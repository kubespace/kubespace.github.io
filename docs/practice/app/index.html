<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<title>KubeSpace - 应用管理</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<meta name="generator" content="mkdocs-1.3.0, mkdocs-gitbook-">

<link rel="shortcut icon" href="../../images/favicon.ico" type="image/x-icon">
<meta name="HandheldFriendly" content="true"/>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta rel="next" href="" />
<link href="../../css/style.min.css" rel="stylesheet">
<link href="../../css/gitbook.css" rel="stylesheet"> 
</head>

<body>
<div class="gitbook">
  <header class="nav">
    <a class="title" style="cursor: pointer;" href="/">
      <span style="display:inline-block;vertical-align: middle;margin-top: -4px;">KubeSpace</span>
    </a>

    <ul class="nav-ul">
      <li class="nav-ul-li" > 
        <a :underline="false" class="nav-ul-li-link" target="_blank" href="https://github.com/kubespace/kubespace">
          GitHub
        </a>
      </li>
      <li class="nav-ul-li" style="margin-right: 20px;"> 
        <a :underline="false" class="nav-ul-li-link" href="/docs">
          文档
        </a>
      </li>
      <!-- <li class="nav-ul-li">
        <el-link :underline="false" class="nav-ul-li-link">文档</el-link>
      </li>
      <li class="nav-ul-li">
        <el-link :underline="false" class="nav-ul-li-link">联系我们</el-link>
      </li> -->
    </ul>
  </header>
</div>
<div class="book" style="height: calc(100% - 50px);">
<div class="book-summary" style="background-color: white; width: 250px;">
<!-- <div id="book-search-input" role="search">
<input type="text" placeholder="Type to search" />
</div> end of book-search-input -->

<nav role="navigation">
<ul class="summary" style="padding-left: 20px;">
<!-- <li>
<a href="../.." target="_blank" class="custom-link">KubeSpace</a>
</li> -->
<!-- <li class="divider"></li> -->
<li class="chapter" data-path="">
<a href="../..">安装配置</a>
<li class="header">最佳实践</li>

<li style="margin-left: 20px;" class="active">
<a href="./">应用管理</a>
</li>

<li style="margin-left: 20px;" class="">
<a href="../appstore/">应用商店</a>
</li>

<li style="margin-left: 20px;" class="">
<a href="../pipeline_build/">最简流水线之构建</a>
</li>

<li style="margin-left: 20px;" class="">
<a href="../pipline_deploy.md">最简流水线之部署</a>
</li>

<li style="margin-left: 20px;" class="">
<a href="../pipeline_release/">最简流水线之发布</a>
</li>

<li class="chapter" data-path="cluster/cluster/">
<a href="../../cluster/cluster/">集群管理</a>
<li class="header">工作空间</li>

<li style="margin-left: 20px;" class="">
<a href="../../workspace/workspace/">空间管理</a>
</li>

<li style="margin-left: 20px;" class="">
<a href="../../workspace/apps/">应用管理</a>
</li>

<li style="margin-left: 20px;" class="">
<a href="../../workspace/resource/">空间资源</a>
</li>

<li style="margin-left: 20px;" class="">
<a href="../../workspace/member/">成员管理</a>
</li>

<li class="header">流水线</li>

<li style="margin-left: 20px;" class="">
<a href="../../pipeline/pipeline_space/">流水线空间</a>
</li>

<li style="margin-left: 20px;" class="">
<a href="../../pipeline/pipeline/">代码流水线</a>
</li>

<li style="margin-left: 20px;" class="">
<a href="../../pipeline/build/">构建流水线</a>
</li>

<li style="margin-left: 20px;" class="">
<a href="../../pipeline/resource/">资源管理</a>
</li>

<li style="margin-left: 20px;" class="">
<a href="../../pipeline/member/">权限管理</a>
</li>

<li class="chapter" data-path="appstore/appstore/">
<a href="../../appstore/appstore/">应用商店</a>
<li class="header">平台配置</li>

<li style="margin-left: 20px;" class="">
<a href="../../platform/secret/">密钥管理</a>
</li>

<li style="margin-left: 20px;" class="">
<a href="../../platform/repository/">镜像仓库</a>
</li>

<li style="margin-left: 20px;" class="">
<a href="../../platform/user/">用户管理</a>
</li>

<li style="margin-left: 20px;" class="">
<a href="../../platform/permission/">平台权限</a>
</li>

<!-- <li class="divider"></li> -->



<!--<li><a href="http://www.mkdocs.org">-->
<!--Published with MkDocs-->
<!--</a></li>-->

<!--<li><a href="https://github.com/GitbookIO/theme-default">-->
<!--Theme by GitBook-->
<!--</a></li>-->
</ul>

</nav>

</div> <!-- end of book-summary -->

<div class="book-body" style="left: 250px;">
<div class="body-inner">
<div class="book-header" role="navigation">

<!-- Title -->
<h1>
<i class="fa fa-circle-o-notch fa-spin"></i>
<a href="." ></a>
</h1>

</div> <!-- end of book-header -->

<div class="page-wrapper" tabindex="-1" role="main">
<div class="page-inner" style="max-width: 850px;">
<div id="book-search-results">
<div class="search-noresults">

<section class="normal markdown-section">



<h1 id="kubespace">KubeSpace之应用管理</h1>
<p><a href="https://kubespace.cn">KubeSpace</a>是一个DevOps以及Kubernetes多集群管理平台。</p>
<h3 id="_1">准备</h3>
<h5 id="golang">Golang服务</h5>
<p>现在我们有一个很简单的golang http服务，代码托管在<a href="https://github.com/lzeen/go-app">github</a>。</p>
<p>本地启动golang服务，端口为8000：</p>
<pre><code>go run main.go
</code></pre>
<p>请求http://127.0.0.1:8000/current_time返回当前时间：</p>
<pre><code>curl http://127.0.0.1:8000/current_time
Hello, current time: 2022-05-08 11:11:33.632898 +0800 CST m=+18.871691849
</code></pre>
<h5 id="_2">构建镜像</h5>
<p>编译golang代码：</p>
<pre><code>CGO_ENABLED=0 LD_FLAGS=-s GOOS=linux go build -o go-app
</code></pre>
<p>在代码库中有Dockerfile，构建服务镜像，并推送到镜像仓库</p>
<pre><code>docker build -t registry.cn-hangzhou.aliyuncs.com/librrary/go-app:v1 .
docker push registry.cn-hangzhou.aliyuncs.com/librrary/go-app:v1
</code></pre>
<p>在装有docker的服务器运行镜像</p>
<pre><code>docker run -it --rm -p 8000:8000 registry.cn-hangzhou.aliyuncs.com/librrary/go-app:v1
</code></pre>
<h3 id="_3">创建应用</h3>
<p>在KubeSpace平台创建应用非常简单。</p>
<h5 id="_4">创建一个测试环境</h5>
<p>首先，创建一个工作空间「测试环境-1」，工作空间绑定一个K8s集群中的命名空间，通过命名空间来隔离不同环境的资源。</p>
<p><img alt="image-20220508115532941" src="../images/workspace-test-1.png" /></p>
<p>如上，「测试环境-1」绑定 local 集群中的 test-1 命名空间。</p>
<h5 id="go-app">创建go-app应用</h5>
<p>进入到「测试环境-1」工作空间，进入「应用管理」，点击「创建应用」按钮。</p>
<p><img alt="image-20220508120104896" src="../images/workspace_app_create_btn.png" /></p>
<p>创建应用分为「基本信息」跟「应用配置」两部分。</p>
<p>在基本信息输入如下：</p>
<p><img alt="image-20220508120328898" src="../images/app_baseinfo.png" /></p>
<p>在应用配置中只需要输入镜像即可：</p>
<p><img alt="image-20220508120539277" src="../images/app_config_image.png" /></p>
<p>其它配置还包括：</p>
<ul>
<li>容器组：可以添加多个容器，容器中包括镜像、启动命令、资源配额等配置；</li>
<li>存储：添加外部存储到工作负载，并挂载到容器中，包括PVC、HostPath、EmptyDir、ConfigMap、Secret、NFS、GlusterFS等；</li>
<li>网络：配置DNS策略，是否使用宿主机网络、PID，以及自定义域名等；</li>
<li>调度：工作负载的调度策略，包括指定节点标签、污点容忍、节点亲和性以及Pod亲和反亲和等；</li>
<li>安全：可以对工作负载中的容器限制用户运行以及sysctl配置等。</li>
</ul>
<p>在右上角点击「保存」按钮，会保存当前应用配置为一个新的版本：</p>
<p><img alt="image-20220508121118126" src="../images/app_version_save.png" /></p>
<p>至此，一个go-app的应用创建成功。</p>
<h3 id="_5">安装应用</h3>
<p>go-app应用创建成功之后，在应用列表可以进行安装。</p>
<p><img alt="image-20220508121622109" src="../images/app_list_install.png" /></p>
<p>点击「安装」之后，还可以选择「应用版本」以及对「应用镜像」、「镜像标签」进行修改。</p>
<p><img alt="image-20220508121804860" src="../images/app_install_dialog.png" /></p>
<p>安装之后，在列表页点击「应用名称」，可以查看应用的资源详情、容器日志、进入容器Shell等。</p>
<p><img alt="image-20220508122310502" src="../images/app_install_detail.png" /></p>
<p>可以看到，go-app的Pod已经运行正常，访问Pod IP，看服务是否正常：</p>
<pre><code>curl http://10.244.0.131:8000/current_time
Hello, current time: 2022-05-08 04:23:22.316105117 +0000 UTC m=+219.645432028
</code></pre>
<h3 id="_6">对外访问</h3>
<p>现在，我们已经有一个在K8s集群内运行的go-app服务了。但是集群外部访问不到，可以通过以下两种方式：</p>
<ul>
<li>Service NodePort</li>
<li>Ingress</li>
</ul>
<h5 id="service">添加Service</h5>
<p>在应用列表中，点击「编辑」go-app应用，添加应用端口以及Service。</p>
<p>如下，go-app应用容器配置中添加8000端口。</p>
<p><img alt="image-20220508134809986" src="../images/app_edit_port.png" /></p>
<p>如下，首先添加Service资源，并选择Service类型为NodePort，点击「+ 添加服务端口」，其中NodePort为「30080」。</p>
<p><img alt="image-20220508140105848" src="../images/app_edit_add_service.png" /></p>
<p>配置好Service之后，右上角点击「保存」，会对go-app应用配置生成一个新的版本，其中版本号修改为「0.0.2」。</p>
<p><img alt="image-20220508135336392" src="../images/app_edit_service_dialog.png" /></p>
<p>创建新的版本之后，在应用列表页，可以对go-app进行升级，版本选择「0.0.2-xxxxxx」。</p>
<p><img alt="image-20220508135519240" src="../images/app_upgrade.png" /></p>
<p>go-app升级之后，在集群外访问集群内任意一台机器的30080端口。</p>
<p>如下，其中10.240.163.1为宿主机ip地址：</p>
<pre><code>curl http://10.240.163.1:30080/current_time
Hello, current time: 2022-05-08 06:03:30.467495512 +0000 UTC m=+57.204330272
</code></pre>
<h5 id="ingress">配置Ingress</h5>
<p>配置Ingress前，请确保您的集群中已安装了IngressController，具体请参考https://kubernetes.io/zh/docs/concepts/services-networking/ingress-controllers/。</p>
<p>在「测试环境-1」工作空间中，点击左侧导航栏「网络」-「路由」，点击「创建」。</p>
<p>如下，添加Host为「go-app」的路由规则，并配置后端服务为我们之前创建的go-app Service，端口为「8000」。</p>
<p><img alt="image-20220508141052231" src="../images/ingress_create.png" /></p>
<p>创建Ingress之后，我们可以在集群外的本地hosts配置域名，并通过域名访问。</p>
<pre><code>echo '10.240.163.1 go-app' &gt;&gt; /etc/hosts
curl http://go-app/current_time
Hello, current time: 2022-05-08 06:03:30.467495512 +0000 UTC m=+57.204330272
</code></pre>
<h3 id="_7">克隆</h3>
<p>现在我们已经在「测试环境-1」中初始化创建了go-app应用并正常安装运行了，那么可以在该环境进行测试。</p>
<p>这时，go-app有一个新的功能开发完成要进行测试，增加了<strong>/v2/current_time</strong>接口，将返回时间进行了更好的格式化显示。</p>
<pre><code>curl http://127.0.0.1:8000/v2/current_time
Hello, current time: 2022-05-08 16:16:21
</code></pre>
<p>并构建了新的镜像：<code>registry.cn-hangzhou.aliyuncs.com/librrary/go-app:v2</code></p>
<p>但是「测试环境-1」还需要测试其他功能，那么我们可以创建一个新的环境「测试环境-2」，绑定新的命名空间。</p>
<p><img alt="image-20220508160712878" src="../images/workspace_test-2.png" /></p>
<p>创建完成之后，我们可以在「测试环境-1」中，将应用<strong>克隆</strong>到「测试环境-2」中，快速初始化新的环境，并安装运行。</p>
<p><img alt="image-20220508162043162" src="../images/app_clone.png" /></p>
<p>在「测试环境-2」中，对go-app进行安装，将镜像标签从「v1」修改为「v2」。</p>
<p><img alt="image-20220508162254743" src="../images/app_clone_install.png" /></p>
<p>但是安装时，会报错如下，提示30080的端口已被分配：</p>
<p><img alt="image-20220508162434536" src="../images/app_clone_install_error.png" /></p>
<p>那么，我们可以重新换一个端口，编辑go-app应用，将Service的NodePort端口修改为「30081」。</p>
<p><img alt="image-20220508162723403" src="../images/app_clone_edit_service.png" /></p>
<p>点击「保存」，并将版本号保存为「0.0.3」。</p>
<p><img alt="image-20220508162905664" src="../images/app_clone_edit_save.png" /></p>
<p>保存之后，安装go-app应用，等go-app状态为「运行中」后，验证应用是否正常运行：</p>
<pre><code>curl http://10.240.163.1:30081/v2/current_time
Hello, current time: 2022-05-08 08:44:18
</code></pre>
<p>OK，收工！</p>
<h3 id="_8">交流沟通</h3>
<p>如果您在使用过程中，有任何问题、建议或功能需求，欢迎随时跟我们交流或提交<a href="https://github.com/kubespace/kubespace/issues">issue</a>。</p>
<p>可以使用QQ扫描下面二维码，加入我们的QQ交流群。</p>
<p><img src="/docs/images/qq-qrcode.png" alt="image-20220508162905664" style="zoom:30%;" /></p>


</section>
</div> <!-- end of search-noresults -->
<div class="search-results">
<div class="has-results">

<!-- <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1> -->
<ul class="search-results-list"></ul>

</div> <!-- end of has-results -->
<div class="no-results">

<!-- <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1> -->

</div> <!-- end of no-results -->
</div> <!-- end of search-results -->
</div> <!-- end of book-search-results -->

</div> <!-- end of page-inner -->
</div> <!-- end of page-wrapper -->

</div> <!-- end of body-inner -->

</div> <!-- end of book-body -->
<script src="../../js/main.js"></script>
<script src="../../search/main.js"></script>
<script src="../../js/gitbook.min.js"></script>
<script src="../../js/theme.min.js"></script>
</body>
</html>